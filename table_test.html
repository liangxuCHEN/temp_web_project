<!doctype html>
<head>
  <title>显示表格处理</title>
  <style type="text/css">
  	html, body {
  	  height: 100%;
  	}

  	html {
  	  display: table;
  	  margin: auto;
  	}

  	body {
  	  display: table-cell;
  	  vertical-align: middle;
  	}
  </style>

</head>

<body>

  <p align="center">
    <input type="file" id="input-file" accept=".csv">
  </p>
  <p>读取文档</p>
  <div id="file_example" class="hot handsontable htColumnHeaders"></div>
  
  <div id="example1" class="hot handsontable htColumnHeaders"></div>
  <div id="example2" class="hot handsontable htColumnHeaders"></div>

  <button onclick="toggle()">
  Toggle type
</button>
  <script src="https://cdn.jsdelivr.net/handsontable/0.28.4/handsontable.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/papaparse/4.1.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/papaparse/4.1.2/papaparse.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/handsontable/0.28.4/handsontable.full.min.css">

  <script type="text/javascript">
  /*debugger*/
  var input = document.getElementById('input-file')
  //读取文档

  input.onchange = function () {
  var file = this.files[0]
  var reader = new FileReader()

  reader.onload = function (e) {
    var csv = e.target.result
    var fileData = Papa.parse(csv, {
      header: true,    //有表头
      skipEmptyLines: true   //空行不要
    })
    console.log('文档数据', fileData)

    var container3 = document.getElementById('file_example')
	var hot3

	hot3 = new Handsontable(container1, {
	  data: fileData.data,
	  colHeaders: fileData.meta.fields,
	  //minSpareRows: 1,
	  //columns: objectColumns,
	});

   }

  reader.readAsText(file)

 }





  var
    objectData = [
        //空出第一行，留作选择参数
    	{
    		"name": "",
		    "age": "",
		    "education": "",
		    "level": ""
    	},
		{
		    "name": "Luc",
		    "age": "22",
		    "education": "Bac+3",
		    "level": "2-4"
		},
		{
		    "name": "Tom",
		    "education": "Bac+4",
		    "level": "3-4",
		    "age": "22",
		},

	],

	ColumnType = [
		{
		    "columnName": "age",
		    "type": "String",
		},
		{
		    "columnName": "name",
		    "type": "String",
		},
		{
		    "columnName": "education",
		    "type": "String",
		},
		{
		    "columnName": "level",
		    "type": "String",
		},
	],


  	
	objectColumns = [
		{
			data: "columnName",
			type: 'text',
		},
    	{
    		data: "type",
      		type: 'dropdown',    //下拉框选择
      		source: ['String', 'Number', 'Date']
    	},
  	],

 container2 = document.getElementById('example2'),
 hot2,
 container1 = document.getElementById('example1'),
 hot1;

 //上面是初始化所有变量
 
  //例子1
  hot1 = new Handsontable(container1, {
    data: ColumnType,
    colHeaders: true,
    minSpareRows: 1,
    columns: objectColumns,
  });


  //例子2
  hot2 = new Handsontable(container2, {
    data: objectData, //数据
    colHeaders: ['xx', 'age', 'education','level'],  //表头， 可以是list， true， false
    rowHeaders: true,    //行数显示
    minSpareRows: 0,  //底部预留行数
    columns:[            //每个列的属性
    	{
    		name: "TT",      //这个名字相当于id，方便查找
    		type: 'text',   //数据类型
    		data: 'name'     //数据来源, 是data的字典， 和colHeader没有关系
    	},
    	{
    		name: "Code",
    		type: 'numeric',
    		data: 'age'
    	},
    	{
    		name: "eee",
    		type: 'text',
    		data: 'education'
    	},
    	{
    		name: "ll",
    		type: 'text',
    		data: 'level'
    	}
    ]
  });




  function selectOption(instance, td, row, col, prop, value, cellProperties) {
	  td.style.verticalAlign = "middle";
	  td.style.textAlign = "center";
	  td.innerHTML = `<select style="width:100%; height:90%;" id="data_type_${row}"><option value ="String" selected="true">字符串</option><option value ="numeric">数字</option><option value ="date">日期</option></select>`;
  }


  function toggle() {
	  
	  console.log(hot2.getCellMeta(0, 0).type);
	  console.log(hot2.getDataAtCell(0, 0));
	  console.log('----------');

     hot2.setCellMeta(0, 0, "renderer", selectOption);   //在第一行, 改变属性只能对cell， 要整列（column），要用遍历
     hot2.setCellMeta(0, 1, "renderer", selectOption);
     
     hot2.render();
     console.log('字段类型', hot2.getData())  //输出数据
}

  </script>
 </body>  